name: Hourly Precipitation Check

on:
  # 1. 定时触发 - 每小时执行一次
  schedule:
    # 每小时的第5分钟执行 (避开整点高峰)
    - cron: '5 * * * *'

  # 2. 手动触发 (方便测试)
  workflow_dispatch:

permissions:
  contents: read

jobs:
  check-precipitation:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code (拉取代码)
      uses: actions/checkout@v4

    - name: Set up Python (设置 Python 环境)
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies (安装依赖)
      run: |
        python -m pip install --upgrade pip
        pip install requests

    - name: Run hourly precipitation check (运行小时级降雨检测)
      env:
        # 将 GitHub Secrets 注入为环境变量
        OWM_API_KEY: ${{ secrets.OWM_API_KEY }}
        WECOM_KEY: ${{ secrets.WECOM_KEY }}
      run: python hourly_precipitation.py
